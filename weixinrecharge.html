<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="screen-orientation" content="portrait">
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="format-detection" content="telephone=no">
    <script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
    <script>
        //window.location.href='http://www.yongche.com/cms/page/waitingforme.html';
        window.isLogin=$.Deferred();

        function is_weixin(){
            var ua = navigator.userAgent.toLowerCase();
            if(ua.match(/MicroMessenger/i)=="micromessenger") {
                return true;
            } else {
                return false;
            }
        }
        if(is_weixin()){
            $.ajax({
                method:'get',
                url:'/ajax/Rechargerebate/getRebateIndex?time='+new Date().toUTCString()
            }).done(function(data){
                //alert(JSON.stringify(data));
                //var temp=JSON.parse(data);
                    var temp=data;
                window.isLogin.resolve(temp);
            }).fail(function(e){
                window.isLogin.reject();
            });
        }else{
            window.location.href='https://3g.yongche.com';
            //alert('请在微信中打开');
        }
    </script>
    <title>充值返现</title>
    <link href="<{asset2:js/app/swiper/swiper3.07.min.css}>" rel="stylesheet">
    <style>
        * { padding:0; margin:0;-webkit-tap-highlight-color: rgba(0,0,0,0);}
        HTML ,body { font-size:12px;height:100%;width:100%; font-family: "Microsoft YaHei", "Hiragino Sans GB", "WenQuanYi Micro Hei", sans-serif;}
        a { color:#fff; text-decoration:none; outline:none;}
        a:hover{ outline:none;}
        li { list-style-type:none;}
        h1 , h2 { font-weight:normal;}
        font {}
        input, input[type="button"], input[type="submit"], input[type="reset"] {-webkit-appearance: none;}
        .tags{
            width: 100%;
            height: 55%;
            position: relative;
            background: url(<{asset2:media/g2/M03/0A/39/rBEBP1fWSC-IIE1kAACK_sC6aLEAAEQHwLU-_kAAIsW046.png}>);
            background-size:cover;
            background-repeat: no-repeat;
            overflow: hidden;
        }
        .tag{
            position: relative;
            overflow: hidden;
            color:#292929;
        }
        .new-user-privilege{
            visibility: hidden;
        //background:url(<{asset2:media/g2/M02/0A/39/rBEBP1fWTc6IRkoyAAANTaLFsEoAAEQLgNubpsAAA1l307.png}>) no-repeat;
            background-position:top right;
            background-size: auto 100%;
            height:25%;
            width:100%;
            position: absolute;
            top:0;
            right:0;
            z-index: 10;
        }
        .bg-blue{
            background:blue;
        }
        .bg-red{
            background:red;
        }
        .bg-green{
            background: green;
        }
        .bg-white{
            background: white;
        }
        .tag .content{
            position: absolute;
            background-size: 100% 100%;
            width: 100%;
            background-repeat: no-repeat;
            -webkit-transform:translateZ(0);
            transform:translateZ(0);
            -webkit-box-shadow:  0 0 4px 4px rgba(194,194,194,0.7);
            box-shadow:  0 0 4px 4px rgba(194,194,194,0.7);
        }
        .tag .selected-content{
            border-radius: 0.3rem;
            -webkit-transform:translateZ(0);
            transform:translateZ(0);
            -webkit-box-shadow:  0 0 4px 4px rgba(194,194,194,0.7);
            box-shadow:  0 0 4px 4px rgba(194,194,194,0.7);
        }
        .bg-noRewards, .bg-hasRewards {
            background: transparent;
        }
        .input-tag{
        }
        .tag .content .bg-img{
            position:absolute;
            bottom: 5%;
            width: 70%;
            margin-left:15%;
        }
        .bg-noRewards .amount{
            position: relative;
            height: 30%;
            font-size: 0.7rem;
        }
        .bg-noRewards .info{
            position: relative;
            height: 12%;
            font-size: 0.9rem;
            font-weight: bold;
        }
        .bg-noRewards .text-area,.bg-hasRewards .text-area{
            text-align: center;
            width: 100%;
            position: absolute;
            bottom: 0%;
        }
        .bg-noRewards .text-area .money,.bg-hasRewards .text-area .money{
            font-size: 1.8rem;
            font-weight: 900;
        }
        .bg-hasRewards .amount{
            position: relative;
            width: 100%;
            height: 28%;
            margin-bottom: 0%;
            font-size: 0.7rem;
        }
        .bg-hasRewards .info{
            position: relative;
            width: 100%;
            height: 10%;
            margin-bottom: 0.3rem;
            font-size: 0.9rem;
            font-weight: bold;
        }
        .bg-hasRewards .divide-line,.input-tag .divide-line{
            width: 100%;
            height: 1px;
            margin: 5px 0;
            background: #E4E5E5;
        }
        .bg-hasRewards .new-user{
            position:relative;
            height:0.9rem;
            line-height: 0.9rem;
            font-size: 0.7rem;
            background: #FC4B47;
            width:5rem;
            margin: 0 auto;
            margin-top: 0.7rem;
            border-radius: 0.5rem;
            -webkit-border-radius: 0.5rem;
            color:white;
            text-align: center;
        }
        .bg-hasRewards .other-rewards{
            position: relative;
            height: 0.9rem;
            line-height: 0.9rem;
            width: 100%;
        }
        .bg-hasRewards .other-rewards .text-area{
            position: absolute;
            color:#323232;
            text-align: center;
            font-size: 0.9rem;
            font-weight: bold;
            bottom: 0;
        }
        .input-tag .title{
            color:#323232;
            position: relative;
            font-size: 1rem;
            height: 40%;
            width: 100%;
            font-weight: bold;
        }
        .input-tag .title .text-area{
            top:50%;
            margin-top: -0.5rem;
            text-align: center;
            width: 100%;
            position: absolute;
        }
        .input-tag .input-area{
            position: relative;
            color: #323232;
            height: 25%;
            width: 100%;
        }
        .input-tag .input-area input{
            position: relative;
            margin-top: 0%;
            margin-bottom: 5%;
            margin-left: 12%;
            padding: 5% 10px;
            height: 16%;
            text-align: center;
            line-height: normal;
            width: 70%;
            font-size: 1rem;
            border-radius: 6px;
            border:1px solid #c8c8c8;
            outline:none;
        }
        .input-tag .info-area{
            position: relative;
            height: 30%;
            width: 100%;
            font-size: 0.8rem;
        }
        .input-tag .info-area .text-area{
            text-align: center;
            width: 100%;
            position: absolute;
            top: 10px;
        }
        .pagination{
            position: absolute;
            bottom: 0;
            height: 1.5rem;
            margin: 0 0;
        }
        .swiper-pagination-bullet{
            width: 0.4rem;
            height: 0.4rem;
            display: inline-block;
            border-radius: 1.2rem;
            background: #909090;
            opacity: .2;
        }
        .swiper-pagination-bullet-active {
            opacity: 1;
            background: #949494;
        }
        .user-info{
            width: 100%;
            height:2rem;
            line-height: 3rem;
            font-size: 0.8rem;
            text-align: center;
        }
        .other{
            position: relative;
            width: 100%;
        }
        .other .charge-area{
            display: block;
            width: 100%;
            height: 3rem;
            padding-top: 3%;
        }
        .other .apple-area{
            display: none;
            width: 100%;
            height: 3rem;
            padding-top: 5%;
        }
        .other .charge-area .normal-charge{
            width: 86%;
            height: 2.4rem;
            line-height: 2.4rem;
            margin-left: 7%;
            text-align: center;
            background:#FC4B47;
            color:white;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 1.2rem;
            -webkit-box-shadow:  1px 0px 1px 0px #FF9596,
            -1px 0px 1px 0px #FF9596,
            0px 2px 2px 0px #FF9596;
            box-shadow:  1px 0px 1px 0px #FF9596,
            -1px 0px 1px 0px #FF9596,
            0px 2px 2px 0px #FF9596;
        }
        .other .apple-area .normal-charge{
            float:left;
            width: 40%;
            height: 2.4rem;
            line-height: 2.4rem;
            margin-left:6%;
            background:#FC4B47;
            text-align: center;
            color:white;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 8px;
        }
        .other .apple-area .apple-pay-charge{
            float: right;
            width: 40%;
            margin-right:6.5%;
            flex-grow:1;
            height: 2.3rem;
            line-height:2.3rem;
            text-align: center;
            border-radius:8px;
            border: 1px #000000 solid;
            color:#000000;
            background: url(<{asset2:media/g2/M04/08/04/rBEBJVe1HtiIQ9vXAAAP_4yh0LQAADJcwDTrFwAABAX865.png}>);
            background-size:100% 100%;
        }
        .other .protocol{
            position: relative;
            width: 100%;
            text-align: center;
            line-height: 0.8rem;
            font-size: 0.6rem;
            color:#8F8F8F;
        }
        .other .protocol .activity-btn{
            color:#1F1F1F;
        }
        .other .to-input{
            width: 100%;
            height: 15%;
            padding-top: 2%;
            padding-bottom: 2%;
            line-height:  15%;
            font-size: 0.9rem;
            text-align: center;
            color:#D4D4D4;
            text-decoration:underline;
        }
        .other .info-area{
            position: relative;
            width: 90%;
            margin:0.5rem 5% 0.2rem 5%;
            height: 2rem;
        }
        .other .info-area .divide-line{
            float: left;
            height:0.9rem;
            width: 1px;
            background:#D4D4D4;
            margin-top: 0.5rem;
        }
        .other .info-area .item{
            float: left;
            width: 33%;
            height: 2rem;
            line-height: 2rem;
            font-size: 0.7rem;
            color:#1F1F1F;
            text-align: center;
        }
        .other .info-area .item a{
            width: 100%;
            text-align: center;
            color:#1F1F1F;
            text-decoration: underline;
        }
        .rebate-info{
            display: none;
            position: absolute;
            top:0;
            left:0;
            z-index: 9999;
            width: 100%;
            height:100%;
            background:rgba(0,0,0,0.75);
        }
        .rebate-info .pop-box{
            position: absolute;
            top:15%;
            bottom:15%;
            left:2rem;
            right:2rem;
            background:white;
            border-radius:5px;
        }
        .rebate-info .pop-box .header{
            width: 100%;
            height: 3.5rem;
            line-height: 3.5rem;
            text-align: center;
            color:#FC4B47;
            font-size: 1rem;
            font-weight:bold;
        }
        .rebate-info .pop-box .divide-line{
            width: 100%;
            height: 1px;
            background:#D4D4D4;
        }
        .rebate-info .pop-box .content{
            position: absolute;
            top:3.5rem;
            bottom: 4.5rem;
            padding: 1rem;
            padding-top: 1.5rem;
            color:#646464;
            font-size: 0.6rem;
            overflow-y: auto;
        }
        .rebate-info .shadow{
            position: absolute;
            bottom: 4.5rem;
            margin-bottom: -1px;
            height: 1rem;
            width: 90%;
            left:5%;
            background: linear-gradient(top,rgba(255,255,255,0),rgba(255,255,255,1));
            background: -webkit-linear-gradient(top,rgba(255,255,255,0),rgba(255,255,255,1));
        }
        pre{
            word-wrap: break-word;
            white-space: pre-wrap;
        }
        .rebate-info .pop-box .footer{
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 4rem;
        }
        .rebate-info .pop-box .footer .i-know{
            width: auto;
            position: absolute;
            left: 0rem;
            right:2rem;
            margin-top: 0.5rem;
            background: #FC4B47;
            color:white;
            -webkit-box-shadow:  1px 0px 1px 0px #FF9596,
            -1px 0px 1px 0px #FF9596,
            0px 2px 2px 0px #FF9596;
            box-shadow:  1px 0px 1px 0px #FF9596,
            -1px 0px 1px 0px #FF9596,
            0px 2px 2px 0px #FF9596;
            font-weight: bold;
        }
        .norebate-info{
            display: none;
            position: absolute;
            top:0;
            left:0;
            z-index: 9999;
            width: 100%;
            height:100%;
            background:rgba(0,0,0,0.75);
        }
        .norebate-info .pop-box{
            position: absolute;
            top:7rem;
            left:2rem;
            right: 2rem;
            height: 16rem;
            background: white;
            border-radius: 5px;
        }
        .norebate-info .pop-box .header{
            width: 100%;
            height: 4rem;
            line-height: 4rem;
            text-align: center;
            color:#FC4B47;
            font-size: 1.2rem;
            font-weight:bold;
        }
        .norebate-info .pop-box .divide-line{
            width: 100%;
            height: 1px;
            background:#D4D4D4;
        }
        .norebate-info .pop-box .content{
            height: 2.4rem;
            line-height: 1.2rem;
            padding-top: 0.5rem;
            width: 100%;
            text-align: center;
            font-size: 0.8rem;
            color:#646464;
        }
        .norebate-info .pop-box .back-btn{
            margin-top: 0rem;
            background: #FC4B47;
            color:white;
            -webkit-box-shadow:  1px 0px 1px 0px #FF9596,
            -1px 0px 1px 0px #FF9596,
            0px 2px 2px 0px #FF9596;
            box-shadow:  1px 0px 1px 0px #FF9596,
            -1px 0px 1px 0px #FF9596,
            0px 2px 2px 0px #FF9596;
        }
        .norebate-info .pop-box .go-btn{
            margin-top: 0.8rem;
            border:1px #D2D2D2 solid;
            color:#646464;
        }
        .normal-btn{
            width: 80%;
            height: 2.2rem;
            border-radius: 1.1rem;
            line-height: 2.2rem;
            font-size: 0.8rem;
            margin-left: 10%;
            text-align: center;
        }
        .top-align{
            padding-bottom: 0rem;
        }
        .bottom-align{
            padding-top: 1.3rem;
        }
        .red-text{
            color:#FC4B47;
        }
        #rebate-rule{
            display: none;
        }
        #rebate-protocol{
            display: none;
        }
        .float-area{
            position: absolute;
            top:0;
            left:0;
            z-index: 9999;
            width: 100%;
            height:100%;
            background:rgba(240,240,240,1);
        }
        .float-area .header{
            height: 3.6rem;
            line-height: 3.6rem;
            font-size: 1.2rem;
            width: 100%;
            text-align: center;
            font-weight:bold;
        }
        .float-area .content{
            position: absolute;
            padding: 0% 5%;
            color:#7E7E7E;
            left:0;
            right:0;
            top:3.6rem;
            bottom: 4rem;
            overflow-y: auto;
        }
        .float-area .shadow{
            position: absolute;
            bottom: 4rem;
            margin-bottom: -1px;
            height: 3rem;
            width: 90%;
            left:5%;
            background: linear-gradient(top,rgba(240,240,240,0),rgba(240,240,240,1));
            background: -webkit-linear-gradient(top,rgba(240,240,240,0),rgba(240,240,240,1));
        }
        .float-area .exit{
            position: absolute;
            bottom:1rem;
            background: url(<{asset2:media/g2/M01/07/11/rBEBP1er3niIXR6KAAAHqq9WERAAAC1igP_9CEAAAfC486.png}>) no-repeat;
            background-size: 100% 100%;
            left:50%;
            margin-left: -1rem;
            height:2rem;
            width: 2rem;
        }
        #is-black{
            display: none;
            position: absolute;
            top:0;
            left:0;
            z-index: 9999;
            width: 100%;
            height:100%;
            background:rgba(0,0,0,0.6);
        }
        #is-black .pop-box{
            position:fixed;
            top:1rem;
            bottom: 3rem;
            left:1rem;
            right:1rem;
            background-color:white;
            border-radius:0.5rem;
            -webkit-border-radius: 0.5rem;
        }
        #is-black .pop-box .header{
            position: relative;
            display: block;
            height: 200px;
            border-top-left-radius: 0.5rem;
            border-top-right-radius:0.5rem;
            background:#B4BFB6;
        }
        #is-black .pop-box .header img{
            position: absolute;
            height:100px;
            width: 100px;
            top:0;
            bottom:0;
            left:0;
            right:0;
            margin: auto;
        }
        .nav-area{
            width: 90%;
            height:auto;
            overflow-y: auto;
            margin: 15px 6% 0 4%;
            font-size: 0.9rem;
        }
        .nav-item{
            position: relative;
            float:left;
            height:2.2rem;
            width:29%;
            margin:3px 1.35%;
            text-align: center;
            border-radius:8px;
            -webkit-border-radius: 8px;
            line-height:2.2rem;
            border:2px solid #E2E2E2;
        }
        .selected-nav-item{
            color:#FF5252;
            border:2px solid #FF5252;
            font-weight:bold;
        }
        .selected-flag{
            position: absolute;
            bottom: 0;
            right:0;
            height:1rem;
            margin-bottom: -1px;
            width:auto;
            visibility: hidden;
        }
        .selected-flag-visible{
            visibility: visible;
        }
        .to-link{
            display: block;
            width: 100%;
            height: 1.5rem;
            line-height: 1.5rem;
            color:#FF4E4E;
            text-decoration: underline;
            font-size: 0.8rem;
            text-align: center;
        }
        .to-link .advertise{
            font-size: 0.6rem;
            text-decoration: underline;
            bottom: 0;
            color:#C4C4C4;
        }
        @media screen and(max-width: 320px) {
            html{
                font-size:16px;
            }
        }
        @media screen and (min-width: 321px) and (max-width: 360px){
            html{
                font-size: 18px;
            }
        }
        @media screen and (min-width:361px ){
            html{
                font-size: 20px;
            }
        }
        .alertContHeader { width:90%; padding-left:5%;padding-right: 5% ;margin-top:10px}
        .alertCont { height:75%; width:90%; padding-left:5%;padding-right: 5%;margin-top:10px;overflow:auto; overflow-x:hidden;}
        .alertCont p { height:1rem;font-size:.5rem; line-height:1rem; padding-bottom:10px; color:#666; word-break:break-all;}
        .alertCont p a { color:#C00;}
        .alertCont p b { color:#f19eb6; font-size:10.7rem; font-weight:normal;}
        .loading{display: none;width: 100%;height: 100%;background-color: #f0f0f0;opacity:0.7;position: fixed;left: 0;top: 0;bottom:0;right:0;z-index: 9999;color: #888;font-size: 20px;text-align: center;margin:auto;}
        .loading img{display: block;height:50px;width:50px;opacity:0.7;position: absolute;left: 50%;top: 50%;margin-left:-25px;margin-top:-25px;}
        .loading p{display: block;height:50px;width:100%;position: absolute;top: 60%;}
    </style>
</head>
<body>
<div class="swiper-container tags">
    <div class="new-user-privilege" ></div>
    <div class="swiper-wrapper">
    </div>
    <!--<div class="swiper-pagination pagination" id="pagination"></div>-->
</div>
<div class="nav-area">

</div>
<div class="user-info">充至易到账户</div>
<div class="other">
    <div class="charge-area">
        <div class="normal-charge" >立即充值</div>
    </div>
    <div class="apple-area">
        <div class="normal-charge" >立即充值</div>
        <div class="apple-pay-charge" ></div>
    </div>
    <div class="protocol">
        点击<span class="red-text">立即充值</span>，即表示您已经同意易到<span class="activity-btn" id="protocol">《充返活动协议》</span>
    </div>
    <div class="info-area">
        <div class="item">余额<span id="balance"></span>元</div>
        <div class="divide-line"></div>
        <div class="item" id="rule"><a>活动规则</a></div>
        <div class="divide-line"></div>
        <div class="item"><a id="reward-list" href="">我的奖品</a></div>
    </div>
</div>
<div class="rebate-info">
    <div class="pop-box">
        <div class="header" id="popup-title"></div>
        <div class="divide-line"></div>
        <div class="content" id="popup-value">
        </div>
        <div class="shadow"></div>
        <div class="footer">
            <div class="i-know normal-btn">我知道了</div>
        </div>
    </div>
</div>
<div class="norebate-info">
    <div class="pop-box">
        <div class="header">温馨提示</div>
        <div class="divide-line"></div>
        <div class="content bottom-align ">
            充<span class="red-text" id="min-rebate-charge">300</span>元以上才能享受充返福利哦
            <!--<span>只有选择固定档位标签充值</span><br/>-->
            <!--<span>才可享受充返福利</span>-->
        </div>
        <div class="content top-align">
            确定不要充返福利吗
        </div>
        <div class="back-btn normal-btn">我要充返福利</div>
        <div class="go-btn normal-btn">不要充返福利，继续充值</div>
    </div>
</div>
<div class="float-area" id="rebate-rule">
    <div class="header red-text" id="rule-title"></div>
    <div class="content" id="rule-value">

    </div>
    <div class="shadow"></div>
    <div class="exit"></div>
</div>
<div class="float-area" id="rebate-protocol">
    <div class="header red-text" id="protocol-title"></div>
    <div class="content" id="protocol-value">

    </div>
    <div class="shadow"></div>
    <div class="exit"></div>
</div>
<div id="is-black">
    <div class="pop-box">
        <div class="header"><img src="//i1.yongche.name/media/g1/M01/06/15/rBEARFY7FnuIfX5xAAASm9Iv5oYAACh1wP_6mMAABKz686.png"></div>
        <p class="alertContHeader"><font>抱歉，您的账户不具备参与充值返现的条件，<br/>可能原因如下：</font></p>
        <div class="alertCont">
            <p>1.身份信息与其他用户重合</p>
            <p>2.信用存在风险</p>
            <p>3.历史订单中存在风控订单</p>
            <p>4.账户信息与部分被风控司机一致</p>
            <p>5.其他风险原因</p>
        </div>
    </div>
</div>
<div class="loading" id="loading">
    <img src="<{asset2:media/g1/M01/06/16/rBEARFY8Xy2ID24xAABHEtelIYMAACiQAMX9E8AAEcq787.gif}>" alt="">
    <!--<p>交易处理中...</p>-->
</div>
<script src="//cdn.bootcss.com/Swiper/3.4.1/js/swiper.jquery.min.js"></script>
<script src="//cdn.bootcss.com/jquery_lazyload/1.9.6/jquery.lazyload.min.js"></script>
<!--<script src="<{asset:js/app/i/weixin/js-api.min.js}>"></script>-->
<script src="//res.wx.qq.com/open/js/jweixin-1.0.0.js "></script>
<!-- GA: -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-18761483-4', 'auto');
    ga('send', 'pageview');

</script>
<script>
    //选择类型的类
    function PrivilegeType(activityId,names, num, privilege, info, presentation, imgVisible, imgPath) {
        this.isSelected = false;
        this.activityId=activityId||1053;
        this.number = num||0;
        this.privilege = privilege||'200元起充，400元起返！';
        this.info = info||'';
        this.presentation = presentation||'送' + num + '元';
        this.names = names||['', ''];
        this.imgVisible = imgVisible||'hidden';
        this.imgPath = imgPath||'';
        this.selectedImgVisibility = 'hidden';
        this.isJoinRebate=true;
        this.percent=0;
        this.tagId=0;
        this.otherRewards='';
        this.isInput=false;
        this.tagOrder=0;
        this.index=0;
    }
    PrivilegeType.prototype = {
        selectItem: function () {
            this.isSelected = true;
        },
        unSelectItem: function () {
            this.isSelected = false;
        },
        setNumber: function (num,percent,otherRewards,rewardPresentation) {
            //alert(JSON.stringify(this))
            this.number = Number(num);
            this.percent=percent;
            if(num<rebate.minRebateCharge||this.percent==0){
                this.presentation='不返现';
                if(!!!otherRewards){
                    this.privilege='200元起充，400元起返！'+'<br/>'
                }else{
                    this.privilege='';
                }
            }else{
                this.presentation = '共得'+num*Number(this.percent+100)*0.01+'元余额';
                this.privilege = '送' + (num*Number(this.percent)*0.01).toFixed(2) + '元，共得'+(num*Number(this.percent+100)*0.01).toFixed(2)+'元余额'+'<br/>';
            }
            if(rewardPresentation){
                this.presentation=rewardPresentation;
                this.privilege+=rewardPresentation;
            }
            this.otherRewards=otherRewards;
        }
    };
</script>
<script>
    $('.lazy').lazyload({
        event:'sporty',
        effect : "fadeIn",
    });
    setTimeout(function() { $("img.lazy").trigger("sporty") }, 100);

    function toLoginPage(){
        var link = '/touch/Weixinrecharge/login?done=' + encodeURIComponent(window.location.href);
        window.location.href = link;
    }

    function initParam(){
        window.rebatePage={
            balance:$('#balance'),
            loading:$('#loading'),
            tags:$('.tags'),
            tag:$('.tags .tag'),
            contents:$('.swiper-slide .content'),
            swiperWrapper:$('.swiper-wrapper'),
            inputNumber:$('.input-number'),
            inputPresentation:$('.input-tag .info-area .text-area'),
            normalCharge:$('.normal-charge'),
            appleCharge:$('.apple-pay-charge'),
            normalArea:$('.charge-area'),
            appleArea:$('.apple-area'),
            navArea:$('.nav-area'),
            navItem:$('.nav-item'),
            rebateInfo:{
                that:$('.rebate-info'),
                iKnow:$('.rebate-info .i-know')
            },
            noRebateInfo:{
                that:$('.norebate-info'),
                goBtn:$('.norebate-info .go-btn'),
                backBtn:$('.norebate-info .back-btn')
            },
            rebateRule:{
                that:$('#rebate-rule'),
                exit:$('#rebate-rule .exit')
            },
            rebateProtocol:{
                that:$('#rebate-protocol'),
                exit:$('#rebate-protocol .exit')
            },
            rule:$('#rule'),
            protocol:$('#protocol'),
            other:$('.other'),
            isBlank:{
                that:$('#is-black'),
                alertCont:$('#is-black .alertCont'),
            },
            newUserPrivilege:$('.new-user-privilege'),
            rewardList:$('#reward-list'),
            popupTitle:$('#popup-title'),
            popupValue:$('#popup-value'),
            protocolTitle:$('#protocol-title'),
            protocolValue:$('#protocol-value'),
            ruleTitle:$('#rule-title'),
            ruleValue:$('#rule-value'),
            minRebateCharge:$('#min-rebate-charge'),
            userInfo:$('.user-info')
        };

        window.rebate={
            projectId:86,
            length:4,
            privilegeTypes:null,
            selectedPrivilegeType:null,
            data:null,
            specialActivity:[],
            minRebateCharge:300,
            inputNumber:0,
            isApplePay:false,
            inputIndex:0,
            currentIndex:0,
            document:{},
            tags:{}
        };
        window.userAttribution={};
    }

    window.isLogin.then(
            function(data){
                if(data.code==200){
                    initParam();
                    //alert(JSON.stringify(data))
                    afterLogin(data.result);
                }else if(data.code==530){
                    $.ajax({
                        method:'get',
                        url:'/ajax/Weixin/bindLogin?time='+new Date().toUTCString()
                    }).done(function(res){
                        //var temp=JSON.parse(res);
                        var temp=res;
                        if(temp.code==401||temp.code==530){
                            toLoginPage();
                        }else{
                            if(window.location.href.indexOf('?')>0){
                                window.location.href=window.location.href+"&id="+10000*Math.random();
                            }
                            else{
                                window.location.href=window.location.href+"?id="+10000*Math.random();
                            }
                        }
                    }).fail(function(e){
                        window.isLogin.reject();
                    });
                }
                else{
                    alert('服务异常，请重新加载页面');
                    toLoginPage();
                }
            },
            function(){
                alert('请求异常，请重新进入');
            });

    function afterLogin(result){
        var version_show_subdesc = result.version_show_subdesc,
                webHost = result.webHost;
        userAttribution={
            versionShowSubdesc:version_show_subdesc,
            isBlank:false,
            activityToken:0,
            activityId:1053,
            callbackUrl:result.callback_url,
            risk:1
        };

        rebate.tags={
            noRewardsTag:function(privilegeType){
                var tag='<div class="swiper-slide tag  swiper-no-swiping">'+
                        '<div class="content bg-noRewards">'+
                        '<div class="amount"><span class="text-area">充&nbsp;<span class="money">'+privilegeType.number+'</span>&nbsp;元</span></div>'+
                        '<div class="info"><span class="text-area">'+privilegeType.privilege+'</span></div>'+
                        '<img class="bg-img lazy" src="<{asset2:media/g2/M01/0C/34/rBEBJVf59s6Ibx3HAAAD701pnpkAAE_6gP_--0AAAQT668.png}>"/>'+
                        '</div>'+
                        '</div>';
                return tag;
            },
            hasRewardsTag:function(privilegeType){
                var tag='<div class="swiper-slide tag  swiper-no-swiping">'+
                        '<div class="content bg-hasRewards">'+
                        '<div class="amount"><span class="text-area">充&nbsp;<span class="money">'+privilegeType.number+'</span>&nbsp;元</span></div>'+
                        '<div class="info"><span class="text-area">'+privilegeType.privilege+'</span></div>'+
                        '<div class="other-rewards"><span class="text-area">'+privilegeType.presentation+'</span></div>'+
                        '<img class="bg-img lazy" src="<{asset2:media/g2/M01/0C/34/rBEBJVf59s6Ibx3HAAAD701pnpkAAE_6gP_--0AAAQT668.png}>"/>'+
                        '</div>'+
                        '</div>';
                return tag;
            },
            inputTag:function(privilegeType){
                var tag='<div class="swiper-slide tag  swiper-no-swiping">'+
                        '<div class="content input-tag">'+
                        '<div class="title" ><span class="text-area">其它金额</span></div>'+
//                        '<div class="divide-line"></div>'+
                        '<div class="input-area"><input class="input-number" oninput="rebate.watchInputNumber()" onpropertychange="rebate.watchInputNumber()" onclick="rebate.watchInputNumber()" type="tel" flex-box="1" maxlength="6" placeholder="手动输入充值金额"/></div>'+
                        '<div class="info-area"><span class="text-area">'+privilegeType.privilege+'</span></div>'+
                        '</div>'+
                        '</div>';
                return tag;
            },
            navItem:function(privilegeType){
                var navName=privilegeType.number;
                var tag='';
                if(navName==0){
                    navName='其它金额';
                    tag='<div class="nav-item input-flag" onclick="rebate.toItemIndex('+privilegeType.index+')">'+navName+
                            '<img data-original="<{asset2:media/g2/M01/0B/00/rBEBJVfXq2GIWfNLAAAFuwniE4cAAESpADva9QAAAXT299.png}>" src="<{asset2:media/g2/M01/0C/34/rBEBJVf59s6Ibx3HAAAD701pnpkAAE_6gP_--0AAAQT668.png}>" class="selected-flag lazy"/>'+
                            '</div>'
                }
                else{
                    navName='¥'+navName;
                    tag='<div class="nav-item" onclick="rebate.toItemIndex('+privilegeType.index+')">'+navName+
                            '<img data-original="<{asset2:media/g2/M01/0B/00/rBEBJVfXq2GIWfNLAAAFuwniE4cAAESpADva9QAAAXT299.png}>" src="<{asset2:media/g2/M01/0C/34/rBEBJVf59s6Ibx3HAAAD701pnpkAAE_6gP_--0AAAQT668.png}>" class="selected-flag lazy"/>'+
                            '</div>'
                }

                return tag;
            }
        };
        //检测是否是apple设备
        function checkIsApple() {
            var browser = {
                versions: function () {
                    var u = navigator.userAgent, app = navigator.appVersion;
                    return { //移动终端浏览器版本信息
                        ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
                        android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或uc浏览器
                        iPhone: u.indexOf('iPhone') > -1, //是否为iPhone或者QQHD浏览器
                        iPad: u.indexOf('iPad') > -1 //是否iPad
                    };
                }()
            };

            if (browser.versions.iPhone || browser.versions.iPad || browser.versions.ios) {
                window.location.href = "yongche://checkapplepay?callback=rebate.appPay_callback";
            }
        }

        //验证是否支持apple pay的回调函数
        rebate.appPay_callback=function (status) {
            var isApple = false;
            if (status == 1) {
                isApple = true;
            }
            setPayType(isApple);
        }

        //是否支持apple pay
        function setPayType(isApple) {
            var normalArea=rebatePage.normalArea;
            var appleArea=rebatePage.appleArea;
            if (isApple) {
                normalArea.hide();
                appleArea.show();
            }
            else {
                appleArea.hide();
                normalArea.show();
            }
        }

        (function init(){
            start(initPrivilegeTypes);
        })();
        rebate.afterInitPrivilegeTypes=$.Deferred();

        $.when(rebate.afterInitPrivilegeTypes).then(function(){
            afterInitPrivilegeTypes();
        });
        function afterInitPrivilegeTypes(){
            setTags();
            setTagsBackground();
            setTagHeight();
            initInputNumber();
            initClickEvent();
            produceGallery();
            //initDocument();
            //rebatePage.loading.hide();
            rebatePage.rewardList.attr('href', "/touch/Weixinrecharge/awardList");
            rebatePage.minRebateCharge.text(rebate.minRebateCharge);
            $.ajax({
                method:'get',
                url:'/ajax/Rechargerebate/getDocument?project_id='+rebate.projectId+'&time='+new Date().toUTCString()
            }).success(function (res) {
                console.log(res);
                //var data=JSON.parse(res);
                var data  = res;
                if(data.code=200){
                    if(data.result&&data.result.project_document){
                        initDocument(data.result.project_document);
                    }
                    if(data.result&&data.result.angle_mark){
                        rebatePage.newUserPrivilege.css('visibility','visible');
                        rebatePage.newUserPrivilege.css('background-image','url('+data.result.angle_mark+')');
                    }
                }
                rebatePage.loading.hide();
            }).error(function (e) {
                //alert('服务器异常，请稍后重试');
            })
        }

        function initDocument(document){
            if(document&&document.popup){
                if(document.popup.title){
                    rebatePage.popupTitle.html(document.popup.title);
                }
                if(document.popup.value){
                    rebatePage.popupValue.html(document.popup.value);
                }
            }
            if(document&&document.protocal){
                if(document.protocal.title){
                    rebatePage.protocolTitle.html(document.protocal.title);
                }
                if(document.protocal.value){
                    rebatePage.protocolValue.html(document.protocal.value);
                }
            }
            if(document&&document.rule){
                if(document.rule.title){
                    rebatePage.ruleTitle.html(document.rule.title);
                }
                if(document.rule.value){
                    rebatePage.ruleValue.html(document.rule.value);
                }
            }
        }

        //初始化多种选择类型
        function start(callback) {
            try{
                $.ajax({
                    method:'get',
                    url:'/ajax/Rechargerebate/getWebActiveInfo?time='+new Date().toUTCString()
                }).success(function(data){
                    //alert(JSON.stringify(data));
                    //var temp=JSON.parse(data);
                    var temp=data;
                    callback(temp);
                    rebate.afterInitPrivilegeTypes.resolve();
                }).error(function(e){
                    //alert(JSON.stringify(e));
                });
                $.ajax({
                    method:'get',
                    url:'/ajax/Rechargerebate/getUserAmout?time='+new Date().toUTCString()
                }).success(function(data){
                    //var temp=JSON.parse(data);
                    var temp=data;
                    if(temp.code==200&&temp.result){
                        rebatePage.balance.text(temp.result.amount);
                    }
                }).error(function(e){
                    //alert(JSON.stringify(e));
                });
                $.ajax({
                    method:'get',
                    url:'/ajax/User/getUser?time='+new Date().toUTCString()
                }).success(function(data){
                    //var temp=JSON.parse(data);
                    var temp=data;
                    if(temp.code==200&&temp.result){
                        rebatePage.userInfo.text("充至易到账户"+temp.result.cellphone);
                    }
                }).error(function(e){
                    //alert(JSON.stringify(e));
                })
            }catch (e){
                alert(JSON.stringify(e));
            }
        }
        rebate.toItemIndex=function(index) {
            rebate.gallery.slideTo(index,0,false);
            rebatePage.navItem.removeClass('selected-nav-item');
            $(rebatePage.navItem[index]).addClass('selected-nav-item');
            rebatePage.selectedFlag.removeClass('selected-flag-visible');
            $(rebatePage.selectedFlag[index]).addClass('selected-flag-visible');
            rebate.selectedPrivilegeType=rebate.privilegeTypes[index];

            if(rebate.isNewUser){
                rebatePage.newUserPrivilege.css('visibility','visible');
            }else{
                rebatePage.newUserPrivilege.css('visibility','hidden');
            }
            if(rebate.selectedPrivilegeType&&rebate.selectedPrivilegeType.isInput){
                rebate.watchInputNumber();
                if(rebate.selectedPrivilegeType.number>=1){
                    rebatePage.inputNumber.val(rebate.selectedPrivilegeType.number);
                }
            }
        }
        function initPrivilegeTypes(data){
            rebate.privilegeTypes=[];
            if(data.code==200){
                var result=data.result;
                userAttribution.isBlank=result.is_black;
                userAttribution.risk=result.risk;
                if(userAttribution.isBlank){
                    Risk(userAttribution.risk)
                }
                userAttribution.activityToken="";
                rebate.projectId=result.project_id;
                rebate.document=result.project_document;
                rebate.minRebateCharge=result.no_rebate_price;
                rebate.is_rebate_money_limit=result.is_rebate_money_limit;
                rebate.rebate_money_limit=result.rebate_money_limit;
                var isJoinRebate=result.is_join_rebate;
                if(isJoinRebate==0||isJoinRebate==2){
                    rebate.isNewUser=true;
                }
                else{
                    rebate.isNewUser=false;
                }
                if(result&&result.project_tags&&result.project_tags.length>0){
                    var tags=result.project_tags;
                    var length=result.project_tags.length;
                    for(var i=0;i<length;i++){
                        var tag=tags[i];
                        var privilegeType=new PrivilegeType(tag.activity_id,[tag.recharge,tag.show_name], tag.recharge);

                        if(tag.percent&&tag.percent!='0'){
                            privilegeType.presentation='送' + tag.recharge*Number(tag.percent)*0.01 + '元余额';
                            privilegeType.privilege='送' + tag.recharge*Number(tag.percent)*0.01 + '元,可得'+tag.recharge*Number(100+tag.percent)*0.01+'元余额';
                        }
                        else{
                            privilegeType.presentation='不返现';
                            privilegeType.privilege='可得'+privilegeType.number+'元余额';
                        }
                        if(!!tag.show_name)
                        {
                            privilegeType.presentation=tag.show_name;
                        }
                        if(!!tag.tag_picture){
                            privilegeType.info=tag.tag_picture;
                            privilegeType.imgVisible='visible';
                        }
                        if(!!tag.tag_banner){
                            privilegeType.imgPath=tag.tag_banner;
                        }
                        if(isJoinRebate==0||isJoinRebate==2){
                            privilegeType.isJoinRebate=false;
                        }
                        privilegeType.tagOrder=tag.tag_order;
                        privilegeType.tagId=tag.tag_id;
                        privilegeType.otherRewards=tag.otherRewards;
                        privilegeType.percent=Number(tag.percent);
                        if(tag.activity_id!=1053){
                            rebate.specialActivity.push(tag.activity_id);
                        }
                        if(tag.recharge==0){
                            privilegeType.isInput=true;
                            rebate.inputData=tag;
                        }

                        rebate.privilegeTypes.push(privilegeType);
                    }
                }
                rebate.privilegeTypes.sort(function(x,y){
                    return x.tagOrder-y.tagOrder;
                });
                rebate.length=rebate.privilegeTypes.length;
                for(var i=0;i<rebate.length;i++){
                    rebate.privilegeTypes[i].index=i;
                }

                rebate.selectedPrivilegeType=rebate.privilegeTypes[0];
            }
        }
        //自由输入金额监测
        function initInputNumber() {
            rebatePage.inputNumber=$('.input-number');
            rebatePage.inputPresentation=$('.input-tag .info-area .text-area');
            rebatePage.inputFlag=$('.input-flag');
            var contentWidth=$('body').width();
            if(rebate.length%3==1){
                rebatePage.inputFlag.width(contentWidth*0.855);
            }
            else if(rebate.length%3==2){
                rebatePage.inputFlag.width(contentWidth*0.55);
            }
        }

        //对于弹出提示框的封装
        function Risk(num) {
            var alertCont=rebatePage.isBlank.alertCont;
            var isBlack = rebatePage.isBlank.that;
            //rebatePage.loading.hide();
            isBlack.show();
            if(num == 0) {
                alertCont.html('风控服务请求不到，或没有返回结果')
            } else if(num == -1) {
                alertCont.html('同一手机号、移动设备、支付账号仅能以一个账号参与活动，您的手机号已被其他账号参与过充值返现活动。')
            }
//                else if(num == -2) {
//                    alertCont.html('同一手机号、移动设备、支付账号仅能以一个账号参与活动，您的身份证已被其他账号参与过充值返现活动。')
//                }
            else if(num == -3) {
                alertCont.html('同一手机号、移动设备、支付账号仅能以一个账号参与活动，您的用户信息与上次充返记录不一致。')
            } else if(num == -4) {
                alertCont.html('同一手机号、移动设备、支付账号仅能以一个账号参与活动，您的移动设备已被其他账号参与过充值返现活动。')
            } else if(num == -5) {

                alertCont.html('同一手机号、移动设备、支付账号仅能以一个账号参与活动，您的信用卡已被其他账号参与过充值返现活动。')
            } else if(num <= -6) {
                alertCont.html('1、移动设备上曾登录过多个账号，存在安全隐患<br/>2、个人信息与司机重合<br/>3、存在风险订单')
            } else {
                alertCont.html('1、移动设备上曾登录过多个账号，存在安全隐患<br/>2、个人信息与司机重合<br/>3、存在风险订单')
            }
        }

        rebate.watchInputNumber=function (){
            var inputNumber=$('.input-number');
            rebatePage.inputPresentation=$('.input-tag .info-area .text-area');
            var length = rebate.privilegeTypes.length;
            var temp = inputNumber.val();
            var reg=/^[1-9]\d*$|^0$/;
            if(!reg.test(temp)&&temp){
                inputNumber.val(rebate.inputNumber);
                temp=inputNumber.val();
            }
            else{
                rebate.inputNumber=Number(temp);
            }
            //console.log(rebate.inputNumber);
            if(rebate.inputNumber>0){
                inputNumber.val(rebate.inputNumber);
            }
            else{
                inputNumber.val('');
            }
            //rebate.currentIndex=index-1;
//            rebate.selectedPrivilegeType=rebate.privilegeTypes[rebate.length-1];
            var item=rebate.selectedPrivilegeType;
            var level=gradientLevel(temp);
            var percent=level.percent;
            var otherRewards=level.otherReward;
            var presentation=level.tag_banner;
            if (!!temp) {
                item.setNumber(temp,percent,otherRewards,presentation);
            }
            else {
                item.setNumber(0,percent,otherRewards,presentation);
            }
            rebatePage.inputPresentation.html(item.privilege);
        }
        // 充值回调函数
        rebate.rebate_result=function (transactionId) {
            //alert(transactionId);
            if(!transactionId||transactionId==0){
                alert('支付异常，请重新再试');
                return;
            }
            //rebate.toOtherPage(document.location.href.replace('index','complete'));
            var callbackUrl=userAttribution.callbackUrl;
            var selectedPrivilege=rebate.selectedPrivilegeType;

            if (transactionId == undefined || transactionId == "" ||transactionId==0) {
                setTimeout(function(){
                    var temp=window.location.href;
                    var flag = '?';
                    if(temp.indexOf('?')>0){
                        flag = '&';
                    }
                    window.location.href=window.location.href.replace('index','complete') + flag +"transaction_id=" + transactionId + "&activity_id=" + selectedPrivilege.activityId+'&other_rewards='+encodeURIComponent(selectedPrivilege.otherRewards)+'&total_money='+totalMoney;
                },1000);
            } else {
                var totalMoney=selectedPrivilege.number;
                if(totalMoney>=rebate.minRebateCharge){
                    totalMoney=(selectedPrivilege.number*(selectedPrivilege.percent*0.01+1)).toFixed(2);
                }
                setTimeout(function(){
                    var temp=window.location.href;
                    var flag = '?';
                    if(temp.indexOf('?')>0){
                        flag = '&';
                    }
                    window.location.href=window.location.href.replace('index','complete') + flag +"transaction_id=" + transactionId + "&activity_id=" + selectedPrivilege.activityId+'&other_rewards='+encodeURIComponent(selectedPrivilege.otherRewards)+'&total_money='+totalMoney+'&project_id='+rebate.projectId;;
                    //rebate.toOtherPage(callbackUrl + "?transaction_id=" + transactionId + "&activity_id=" + selectedPrivilege.activityId+'&other_rewards='+encodeURIComponent(selectedPrivilege.otherRewards)+'&total_money='+totalMoney);
                },1000);
            }
        };
        function setTags() {
            var height=$('body').height();
            $('body').height(height);
            var tags='';
            var navs='';
            var privilegeTypes=rebate.privilegeTypes;
            var length=privilegeTypes.length;
            for(var i=0;i<length;i++){
                var privilegeType=privilegeTypes[i];
                if(!!privilegeType.number){
                    if(!!privilegeType.presentation){
                        tags+=rebate.tags.hasRewardsTag(privilegeType);
                    }
                    else{
                        tags+=rebate.tags.noRewardsTag(privilegeType);
                    }
                }else{
                    tags+=rebate.tags.inputTag(privilegeType);
                }
                navs+=rebate.tags.navItem(privilegeType);
            }
            rebatePage.swiperWrapper[0].innerHTML=tags;
            rebatePage.navArea[0].innerHTML=navs;
            rebatePage.newUserPrivilege=$('.new-user-privilege');
            rebatePage.selectedFlag=$('.selected-flag');
//            if(!!!rebate.isNewUser){
//                rebatePage.newUserPrivilege.css('visibility','hidden');
//            }
        }
        function initClickEvent(){
            rebatePage.normalCharge.get(0).onclick=function(){
                if(rebate.is_rebate_money_limit!=1&&rebate.selectedPrivilegeType.number<rebate.rebate_money_limit){
                    alert('充值金额必须大于等于'+rebate.rebate_money_limit+'元');
                    return;
                }
                rebate.isApplePay=false;
                if(rebate.selectedPrivilegeType.number>=rebate.minRebateCharge){
//                if(!rebate.selectedPrivilegeType.isInput){
                    rebatePage.rebateInfo.that.show();
                }else{
                    rebatePage.noRebateInfo.that.show();
                }
            };
            rebatePage.normalCharge.get(1).onclick=function(){
                if(rebate.is_rebate_money_limit!=1&&rebate.selectedPrivilegeType.number<rebate.rebate_money_limit){
                    alert('充值金额必须大于等于'+rebate.rebate_money_limit+'元');
                    return;
                }
                rebate.isApplePay=false;
                if(rebate.selectedPrivilegeType.number>=rebate.minRebateCharge){
                    rebatePage.rebateInfo.that.show();
                }else{
                    rebatePage.noRebateInfo.that.show();
                }
            };
            rebatePage.appleCharge.get(0).onclick=function(){
                if(rebate.is_rebate_money_limit!=1&&rebate.selectedPrivilegeType.number<rebate.rebate_money_limit){
                    alert('充值金额必须大于等于'+rebate.rebate_money_limit+'元');
                    return;
                }
                rebate.isApplePay=true;
//                if(rebate.selectedPrivilegeType.number>=rebate.minRebateCharge){
//                    rebatePage.rebateInfo.that.show();
//                }else{
//                    rebatePage.noRebateInfo.that.show();
//                }
                charge(rebate.isApplePay);
            };
            rebatePage.rule.get(0).onclick=function(){
                rebatePage.rebateRule.that.show();
            };
            rebatePage.rebateRule.exit.get(0).onclick=function(){
                rebatePage.rebateRule.that.hide();
            };
            rebatePage.protocol.get(0).onclick=function(){
                rebatePage.rebateProtocol.that.show();
            };
            rebatePage.rebateProtocol.exit.get(0).onclick=function(){
                rebatePage.rebateProtocol.that.hide();
            };
            rebatePage.rebateInfo.iKnow.get(0).onclick=function(){
                rebatePage.rebateInfo.that.hide();
                charge(rebate.isApplePay)
            };
            rebatePage.noRebateInfo.goBtn.get(0).onclick=function(){
                rebatePage.noRebateInfo.that.hide();
                charge(rebate.isApplePay)
            };
            rebatePage.noRebateInfo.backBtn.get(0).onclick=function(){
                rebatePage.noRebateInfo.that.hide();
                return;
            };
            function charge(isApplePay){
                var selectedPrivilege=rebate.selectedPrivilegeType;
                var url=setPayUrl(selectedPrivilege,isApplePay);
                if(!!!url){
                    return;
                }
                if(selectedPrivilege.number<1&&selectedPrivilege.activityId!=1070){
                    //alert('充值金额必须大于等于1元');
                    rebatePage.inputPresentation.html('充值金额必须大于等于1元');
                    return;
                }
                if (typeof WeixinJSBridge == "undefined"){
                    if( document.addEventListener ){
                        document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
                    }else if (document.attachEvent){
                        document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
                        //document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
                    }
                } else{
                    onBridgeReady();
                }
                function onBridgeReady(){
                    rebatePage.loading.show();
                    $.ajax({
                        method:'get',
                        url:'/ajax/Pay/rebatepay?'+url
                    }).done(function(data){
                        //var temp=JSON.parse(data);
                    var temp=data;
                        rebatePage.loading.hide();
                        if(temp.code==200&&temp.result&&temp.result.status==10){
                            var recharge_transaction_id=temp.result.recharge_transaction_id;
                            var payInfo=temp.result.payInfo;
                            payInfo.timeStamp=payInfo.timeStamp.toString();
                            //alert(JSON.stringify(payInfo));
                            WeixinJSBridge.invoke(
                                    'getBrandWCPayRequest', payInfo,
                                    function(res){
                                        //alert(JSON.stringify(res));
                                        if(res.err_msg == "get_brand_wcpay_request:ok" ) {
                                            rebate.rebate_result(recharge_transaction_id);
                                        }     // 使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回    ok，但并不保证它绝对可靠。
                                    }
                            );
                        }else{
                            alert('网络异常，请重新再试！')
                        }
                    }).fail(function(error){
                        console.log(error)
                        alert('服务异常，请稍后重试');
                    })
                }
            }
        }

        //拼装支付链接地址
        function setPayUrl(selectedPrivilege,isApplePay) {
            var url = "", accountDesc = "";
            //前端判断参数（技术确定），缺少参数的用户点击马上充值出现弹窗，弹窗文案：客官稍后，服务不稳定刷新重试。
            if(!!!selectedPrivilege.activityId) {
                alert('客官稍后，服务不稳定刷新重试');
                return;
            }
            var number=selectedPrivilege.number;

            if (userAttribution.versionShowSubdesc) {
                accountDesc+=encodeURIComponent("本次充值" + selectedPrivilege.number + "元");
            }
            if (userAttribution.isBlank) {//是黑名单用户
                url += "activity_id=&amount=" + number + "&pay_type=3&callback=rebate.rebate_result&activity_token="
            }
            else {
                var temp=rebate.projectId+'|'+selectedPrivilege.tagId+'|3';
                var reverse=  encodeURIComponent(temp);
                var data={order_id:0};
                data=encodeURIComponent(JSON.stringify(data));
                //alert(data);
                url += "from=2&activity_id=" + selectedPrivilege.activityId + "&amount=" + number + "&amount_desc=" + accountDesc + "&pay_type=101&pay_channel=180005&activity_token=" + reverse+'&data='+data;
            }
            //alert(JSON.stringify(selectedPrivilege))
            return url;
        }

        function gradientLevel(amount){
            var retAmount=0;
            if(rebate.inputData&&rebate.inputData.levels){
                var levels=rebate.inputData.levels;
                var length=levels.length;
                levels=levels.sort(function(a,b){
                    a.min_price-b.min_price;
                });
                for(var i=0;i<length;i++){
                    var level=levels[i];
                    if(amount>=level.min_price&&amount<level.max_price){
                        return level;
                    }
                }
            }
            return retAmount;
        }
        function setTagHeight(){
            var contentWidth=$('body').width();
            var tagHeight=contentWidth*42/64;
            rebatePage.contents.height(tagHeight);
            rebatePage.tags.height(tagHeight);
            var navsHeight=rebatePage.navArea.height();
            rebatePage.other.height($('body').height()-tagHeight-navsHeight-15);
        }
        function setTagsBackground(){
            rebatePage.tag=$('.tags .tag');
            rebatePage.contents=$('.swiper-slide .content');
            rebatePage.imgs=$('.swiper-slide .content .bg-img')
            rebatePage.navItem=$('.nav-item');
            var privilegeTypes=rebate.privilegeTypes;
            var tag=rebatePage.tag;
            var length=tag.length;
            if(tag&&tag.length>0){
                for(var i=0;i<length;i++){
                    $(rebatePage.imgs[i]).attr('data-original',privilegeTypes[i].info);
                }
            }
            $('.lazy').lazyload({
                event:'sporty',
                effect : "fadeIn",
            });
            setTimeout(function() { $("img.lazy").trigger("sporty") }, 100);
        }

        function produceGallery(){
            rebate.gallery = new Swiper('.swiper-container', {
                autoplay: 0,//可选选项，自动滑动
                longSwipesRatio:0.3,
                loop:false,
                loopAdditionalSlides:0,
                centeredSlides:true,
                pagination : '.swiper-pagination',
                paginationClickable:true,
                watchActiveIndex: true,
                grabCursorpr: true,
                resizeReInit: true,
                slidesPerView:1,
                watchSlidesProgress : true,
                watchSlidesVisibility : true,
                spaceBetween : 0,
                noSwiping :true,
                direction:'horizontal',
                onTransitionEnd:function(param){
                    var index=param.activeIndex;
                    rebate.selectedPrivilegeType=rebate.privilegeTypes[index];
                    setTagHeight();
                    rebatePage.navItem.removeClass('selected-nav-item');
                    $(rebatePage.navItem[index]).addClass('selected-nav-item');
                    rebatePage.selectedFlag.removeClass('selected-flag-visible');
                    $(rebatePage.selectedFlag[index]).addClass('selected-flag-visible');
                    if(rebate.selectedPrivilegeType.isInput){
                        rebate.watchInputNumber();
                        if(rebate.selectedPrivilegeType.number>=1){
                            rebatePage.inputNumber.val(rebate.selectedPrivilegeType.number);
                        }
                    }
                },
            });
            var index=0;
            var length=rebate.privilegeTypes.length;
            if(length>2){
                index=length-2;
            }
            rebate.toItemIndex(index);
        }
    }
</script>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-18761483-4', 'auto');  ga('send', 'pageview');
</script>
<script>
    $.ajax({
        url:"//weixin.yongche.com/wechat/jssdk/config?url="+encodeURIComponent(window.location.href),
        method:'get',
        dataType:'jsonp'
    }).done(function(data){
        console.log(data);
        if(data.code==200){
            wx_share(data.result);
        }
    }).fail(function(error){
        console.log(error)
    });
    function wx_share(jsData) {
        wx.config({
            debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
            appId: jsData.appId, // 必填，公众号的唯一标识
            timestamp: jsData.timestamp, // 必填，生成签名的时间戳
            nonceStr: jsData.nonceStr, // 必填，生成签名的随机串
            signature: jsData.signature,// 必填，签名，见附录1
            jsApiList: ['onMenuShareAppMessage','onMenuShareTimeline','onMenuShareQQ','onMenuShareWeibo'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
        });
        wx.ready(function(){
            var shareData =
            {
                link:"//h5.yongche.com/touch/Weixinrecharge/index",
                imgUrl:"http://i2.yongche.naMe"+"/media/g2/M04/16/2F/rBEBJVkQR6WIPRSIAAA6Flk8vncAAI2ZgL2u4wAADou165.jpg",
                title:"清爽出行，分享有礼！",
                desc:"邀请好友参与易到充返，立享5%奖励金！赶紧来看看！",
                type: '', // 分享类型,music、video或link，不填默认为link
                dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                success: function (data) {
//                    if(data.errMsg.indexOf('ok'))
//                    {
//                        alert('分享成功');
//                    }else{
//                        alert('分享不成功');   
//                    }
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                    //alert('分享失败');
                }
            };
            wx.onMenuShareAppMessage(shareData);
            wx.onMenuShareTimeline(shareData);
            wx.onMenuShareQQ(shareData);
            //alert('ok');
        });
    }
</script>
</body>
</html>