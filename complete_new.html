<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, target-densitydpi=device-dpi, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="screen-orientation" content="portrait">
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="format-detection" content="telephone=no">
	<title>购买出行卡</title>
	<script src="https://i3.yongche.name/media/g4/M04/00/21/rBEDBVsaXZOIZtJ1AAAPg6xQb3EAAAM_gBNCnkAAA-b7128.js"></script>
	<style>
[v-cloak] {display: none;}
html, body { position: relative; height: 100%;}
body { font-family: Helvetica Neue, Helvetica, Arial, sans-serif; color:#000; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
html, body,ul,li,p,span,div,a,img,section{ margin: 0; padding: 0; box-sizing: border-box; border:0; outline:0;}
ul,li{ list-style: none;} 
a{ text-decoration: none; }
p{ text-indent:0;}
.fl{float: left;}
.fr{float: right;}
/*清除浮动代码*/
.clearfix:after{display:block;clear:both;content:"";visibility:hidden;height:0}
.clearfix{zoom:1}   
   
.wait {width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 10; background-color: #fff; z-index: 99999 background-color: #eee; transition:opacity .3s linear;}
.wait img {display: block; margin: 60% auto; width: 20%; height: auto;}
/*toast提示*/
.toastmsg{ position: fixed; bottom: 6.08rem; width: 100%;}
.toastmsg .toasttext{ margin: 0 auto; width: 5.26rem;line-height: 0.8rem; background: rgba(0,0,0,0.75); color: #fff; z-index: 30; text-align: center; border-radius: 0.08rem;font-size: 0.3rem;height: 0.8rem;}
.slide-up-fade-enter-active { transition: all .3s ease; }
.slide-up-fade-leave-active { transition: all .3s cubic-bezier(1.0, 0.5, 0.8, 1.0); }
.slide-up-fade-enter , .slide-up-fade-leave-to { transform: translateY(100px); opacity: 0; }
/*loading加载页*/
.loading{display: block;background-color: #f0f0f0;opacity:1;color: #888;font-size: 20px;text-align: center;margin:auto;}
.loading img{display: block;height:50px;width:50px;opacity:0.7;position: absolute;left: 50%;top: 50%;margin-left:-25px;margin-top:-25px;}
.loading p{display: block;height:50px;width:100%;position: absolute;top: 60%;}

	</style>	
	<style>
#app{ position: relative;height: 100%;min-height: 10.0rem; }	
.container{ }
.header{ padding: 0 0.6rem; line-height: 0.8rem; }   
.header .balance{ font-size: 0.30rem; color: #323232; font-weight: bold; }
.header .account-details{ display: block; font-size: 0.26rem; color: #888; }

.banners-wrapper{  }
.banners-wrapper .bannerlist{ margin: 0 auto; overflow: hidden; width: 6.9rem; height: 4.5rem; }
.banners-wrapper .bannerlist .banneritem{ font-size: 0; height: 4.5rem; position: relative; }
.banners-wrapper .bannerlist .banneritem .price-wrapper{ position: absolute; bottom: 0.95rem ; right: 0.7rem; color: #FFFFFF; }
.banners-wrapper .bannerlist .banneritem .price-wrapper .formula{ font-size: 0.44rem; }
.banners-wrapper .bannerlist .banneritem .price-wrapper .total-price { font-size: 0.78rem; }
.banners-wrapper .bannerlist .banneritem .price-wrapper .symbol{ font-size: 0.36rem; }
.banners-wrapper .bannerlist .banneritem .price-wrapper .explain{ padding-left: 0.1rem; line-height: 0.28rem; font-size: 0.28rem; }
.banners-wrapper .bannerlist .banneritem .price-wrapper .explain span{ margin-right: 0.5rem; }
.banners-wrapper .bannerlist .banneritem .price-wrapper input{ padding-top: 0.2rem; width: 3.0rem; height: 1.0rem; font-size: 0.8rem; color: transparent; text-align: right; font-weight: bold; background-color: transparent; border-radius: 0.08rem; border: 1px solid white; outline: none; }
.banners-wrapper .bannerlist .banneritem .price-wrapper input.ok-white{ color: white; }
.banners-wrapper .bannerlist .banneritem .price-wrapper input::-webkit-input-placeholder{ color: #cc9897; font-size: 0.58rem; }        
.banners-wrapper .bannerlist .banneritem .tag-desciption { position: absolute; top: 1.5rem; right: 0.7rem; font-size: 0.28rem; line-height: 0.4rem; color: #FFFFFF; }

.tags-wrapper { padding-top: 0.2rem; }
.tags-wrapper .taglist{ margin: 0 auto; overflow: hidden; width: 6.5rem; }
.tags-wrapper .taglist .tagitem{ margin:0 0.2rem 0.12rem 0; display: inline-block; width: 2.02rem; height: 0.94rem; }
.tags-wrapper .taglist .tagitem:nth-child(3n){ margin-right: 0; }
.tags-wrapper .taglist .tagitem .tagitem-inner{ width: 100%; height: 100%; text-align: center; font-size: 0.34rem; line-height: 0.94rem; border: 2px solid #E2E2E2; border-radius: 0.16rem; }

.footer .btn-wrapper{ margin: 0.15rem auto; width: 6.5rem; height: 1.0rem; font-size: 0.44rem; line-height: 1.0rem; text-align: center; color:white; font-weight: bold; }
.footer .btn-wrapper .btn-normal{ border-radius: 1.2rem; }
.footer .btn-wrapper .btn-normal-pay{ float: left; width: 3.0rem; height: 1.0rem; border-radius: 8px; }
.footer .btn-wrapper .btn-apple-pay{ float: right; width: 3.0rem; height: 1.0rem; border-radius:8px; border: 1px #000000 solid; background: url(https://i3.yongche.name/media/g2/M04/08/04/rBEBJVe1HtiIQ9vXAAAP_4yh0LQAADJcwDTrFwAABAX865.png); background-size:100% 100%; }
.footer .statement{ margin-top: 0.28rem; font-size: 0.2rem; text-align: center; color: #8F8F8F; }
.footer .statement .protocol-btn{ color: #000000; }
/*公用弹层背景*/
.mask{ position: absolute; top:0; bottom: 0; left:0; right: 0; z-index: 9999; width: 100%; height:100%; }
/*协议/规则层--start*/
.mask-page{ background:rgba(240,240,240,1); }
.mask-page .title{ height: 1.5rem; line-height: 1.5rem; font-size: 0.5rem; text-align: center; font-weight:bold; color: #FC4B47; }
.mask-page .content{ position: absolute; left:0; right:0; top:1.5rem; bottom: 1.5rem; font-size: 0.24rem; padding: 0 0.32rem; color:#7E7E7E; overflow-y: auto; }
.mask-page .shadow{ position: absolute; bottom: 1.5rem; height: 1.5rem; width: 100%; background: linear-gradient(top,rgba(240,240,240,0),rgba(240,240,240,1)); background: -webkit-linear-gradient(top,rgba(240,240,240,0),rgba(240,240,240,1)); }
.mask-page .exit-wrapper{ position: absolute; bottom:0.6rem; width: 100%; height:0.8rem; }
.mask-page .exit-wrapper .btn-exit{ margin: 0 auto; height:0.8rem; width: 0.8rem; background: url(https://i3.yongche.name/media/g2/M01/07/11/rBEBP1er3niIXR6KAAAHqq9WERAAAC1igP_9CEAAAfC486.png) no-repeat; background-size: 100% 100%; }
/*协议/规则层--end*/
/*黑名单风控提示弹窗--start*/
#is-black{ display: none; background:rgba(0,0,0,0.6); font-size: 0.26rem; }
#is-black .pop-box{ position:fixed; top: 0.5rem; bottom: 1.5rem; left: 0.5rem; right: 0.5rem; background-color: white; border-radius: 0.25rem; -webkit-border-radius: 0.25rem; overflow: hidden; }
#is-black .pop-box .headbg{ position: relative; display: block; height: 4.0rem; background:#B4BFB6; }
#is-black .pop-box .headbg img{ position: absolute; height:2.0rem; width: 2.0rem; top:0; bottom:0; left:0; right:0; margin: auto; }
#is-black .pop-box .content-title{ padding: 0.2rem 0.32rem 0; line-height: 0.36rem; }
#is-black .pop-box .content-text{ padding: 0.2rem 0.32rem; font-size: 0.24rem; line-height: 0.6rem; color:#666; }  
/*黑名单风控提示弹窗--end*/ 
/*确认弹窗--start*/
.mask-confirm{ background: rgba(0,0,0,0.7); }
.mask-confirm .mask-inner{ margin: 3.0rem auto; width: 6.0rem; border-radius: 0.08rem; overflow: hidden; }  
.mask-confirm .mask-inner .confirm-title{ height: 1.0rem; background: #f7f7f7 url(https://i1.yongche.name/media/g3/M00/02/24/rBEDAlugjyuIRJKIAACa9XACtZgAABAJQMD9TEAAJsN403.png) no-repeat center; background-size: 42%; }
.mask-confirm .mask-inner .confirm-content{ background-color: white; padding: 0.44rem 0.3rem; text-align: center; font-size: 0.32rem; line-height: 0.5rem; border-top: solid #c9c9c9 1px; border-bottom: solid #c9c9c9 1px; }
.mask-confirm .mask-inner .confirm-footer{ background-color: white; line-height: 1.0rem; text-align: center; font-size: 0.32rem; color: red; }
/*确认弹窗--end*/

/*活动规则和我的奖励入口--start--现已隐藏*/
.info-area{ position: relative; width: 90%; margin:0.2rem 5% ; height: 1.0rem; }
.info-area .divide-line{ float: left; height:0.4rem; width: 1px; background:#D4D4D4; margin-top: 0.3rem; }
.info-area .item{ float: left; width: 49%; height: 1rem; line-height: 1rem; font-size: 0.3rem; color:#1F1F1F; box-sizing: border-box; }
#rule{ padding-right: 8%; text-align: right; }
#reward-list-css{ text-align: left; padding-left: 8%; }
.info-area .item a{ width: 100%; text-align: center; color:#1F1F1F; text-decoration: underline; }
/*活动规则和我的奖励入口--end--现已隐藏*/        
        
	</style>
</head>
<body>
<div id="app" v-cloak>
	<div class="container">
		<section class="header clearfix">
			<div class="balance fl">余额{{balance}}元</div>
			<a class="account-details fr" :href="account_details">账户明细 <span>&gt;</span></a>
		</section>
		<section class="banners-wrapper">
			<ul class="bannerlist" v-if="project_tags.length>0">
				<li class="banneritem" v-for="(tag,idx) in project_tags" v-show="cur_tag_idx==idx">
					<!--各等级对应的卡片背景-->
					<img v-if="tag.tag_picture" :src="tag.tag_picture" width="100%" height="100%" />
					<!--各等级对应的卡片的描述文字-->
					<section class="tag-desciption">{{tag.show_name}}</section>
					<!--固定金额-->
					<section class="price-wrapper" v-if="tag.recharge!=0">
						<div v-if="tag.percent>0">   <!--充值有返现-->
							<div class="formula">    <!--计算公式-->
								<span>{{tag.recharge}}+{{tag.extra}}=</span><span class="total-price">{{tag.total}}</span><span class="symbol">元</span>
							</div>
							<div class="explain">
								<span>购买</span><span>赠送</span><span>总计</span>
							</div>
						</div>
						<div v-if="tag.percent==0">  <!--充值无返现-->
							<span class="total-price">{{tag.recharge}}</span> <span class="symbol">元</span>
						</div>
					</section>	
					<!--其他金额输入框-->
					<section class="price-wrapper" v-if="tag.recharge==0">
						<input type="tel" :class="{'ok-white':ok_white}" v-model="input_price" @input="watchInput" @propertychange="watchInput" @keyup="watchInput" maxlength="5" placeholder="请输入面值"/>
						<span class="symbol">元</span>
					</section>	
				</li>
			</ul>
		</section>
		<section class="tags-wrapper">  <!--可供选择的金额标签-->
			<ul class="taglist" v-if="project_tags.length>0">
				<li class="tagitem" v-for="(tag,idx) in project_tags" @click="chooseTag(idx)">
					<div class="tagitem-inner" :style="tag_style" v-if="cur_tag_idx==idx">
						<span v-if="tag.recharge>0">￥{{tag.recharge}}</span>
						<span v-if="tag.recharge==0">其他金额</span>
					</div>
					<div class="tagitem-inner" v-if="cur_tag_idx!=idx">
						<span v-if="tag.recharge>0">￥{{tag.recharge}}</span>
						<span v-if="tag.recharge==0">其他金额</span>
					</div>	
				</li>
			</ul>
		</section>
		<section class="footer">
			<div class="btn-wrapper">
				<div class="btn-normal" :style="btn_style" v-if="!support_applepay" @click="payFn(false)">购卡并绑定</div>
				<div class="btn-apple" v-if="support_applepay">   <!--支持Apple pay------该功能已下线-->
					<div class="btn-normal-pay" :style="btn_style" @click="payFn(false)">购卡并绑定</div>
					<div class="btn-apple-pay"  @click="payFn(true)"></div>
				</div>
			</div>
			<p class="statement">点击购卡并绑定，即表示您已经同意易到用车<span class="protocol-btn" @click="showProtocal">《出行卡购买协议》</span></p>
			<!--活动规则与购买协议合并，我的奖品暂不展示-->
			 <!--<div class="info-area">
		        <div class="item" id="rule"><a>活动规则</a></div>
		        <div class="divide-line"></div>
		        <div class="item" id="reward-list-css"><a id="reward-list" :href="rewardlist_url">我的奖品</a></div>
		    </div>-->
		</section>
	</div>
	<div class="mask mask-page" v-show="protocal && show_protocal">  <!--出行卡购买协议-->
		<div class="title " v-if="protocal.title">{{protocal.title}}</div>
	    <div class="content" v-if="protocal.value" v-html="protocal.value"></div>
	    <div class="shadow"></div>
	    <div class="exit-wrapper"><div class="btn-exit" @click="closeMask"></div></div>
	</div>
	
	<div class="mask loading" v-show="loading">  <!--加载中页面-->
	    <img src="https://i1.yongche.name/media/g1/M01/06/16/rBEARFY8Xy2ID24xAABHEtelIYMAACiQAMX9E8AAEcq787.gif" alt="">
	    <p>数据请求中...</p>
	</div>
	
	<div class="mask " id="is-black" v-show="is_black">  <!--黑名单用户，风控提示文案-->
	    <div class="pop-box">
	        <div class="headbg"><img src="//i1.yongche.name/media/g1/M01/06/15/rBEARFY7FnuIfX5xAAASm9Iv5oYAACh1wP_6mMAABKz686.png"></div>
	        <p class="content-title"><font>抱歉，您的账户不具备购买条件，<br/>可能原因如下：</font></p>
	        <div class="content-text" v-html="risk_text"></div>
	    </div>
	</div>
	
	<div class="mask mask-confirm" v-show="show_confirm">
		<div class="mask-inner">
			<div class="confirm-title"></div>
			<div class="confirm-content" v-text="confirm_text">输入的金额必须小于1000元</div>
			<div class="confirm-footer" @click="closeMask">确定</div>
		</div>
	</div>
	
	<transition name="slide-up-fade">
		<div class="toastmsg" v-if="showToast">
			<div class="toasttext" v-html="toastMsg"></div>
		</div>
	</transition>
</div>
		

<script src='https://cdn.bootcss.com/vue/2.5.16/vue.min.js'></script>	
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>	
<script src="https://i3.yongche.name/js/jquery.plugins/jquery.lazyLoad/jquery.lazyload.1.9.3.js"></script>
<!--<script src="js/index.js"></script>-->
<script type="text/javascript">
var rebate = new Vue({
  	el: '#app',
	data:{
		//account_details:'https://pay.yongche.Org/touch/balance/balancelist',   //线下的
		account_details:'https://pay.yongche.com/touch/balance/balancelist.html',  //线上的
		webHost:'',   //www.yongche.com
		version_show_subdesc:'', //当前版本是否支持设置 “需支付*元”-- true
		balance:'',   //账户余额
		loading: true, //是否加载中
		project_id:'',  //项目ID， getActiveInfo接口返回，getDocument接口需要的参数
		params:'', //支付接口需要的参数
		is_black:false,  //是否是黑名单用户
		risk:1,  //风控类型字段，对应风控提示文案不同
		show_protocal:false,  //是否展示 购买协议
		show_confirm:false, //是否展示确认弹窗
		confirm_text:'', //确认弹窗-提示文案
		support_applepay:false, //是否支持apple pay---该功能已下线
		ok_white:false, //控制input的字体颜色
		input_price:'',  //其他金额--输入的金额
		cur_tag_idx:0, //当前选中的金额等级标签，对应“tag_order”
		minRebateCharge:'',  //享有返现的最小充值额度  目前没有使用
		price_range:{   //可充值金额的最大最小值
			max:0,
			min:0
		},
		project_tags:[],
		protocal:{},
		rule:{},
		popup:{},
		levels:[],
		
		color:'#FF5252',  
		tagbg:'https://i2.yongche.name/media/g2/M01/0B/00/rBEBJVfXq2GIWfNLAAAFuwniE4cAAESpADva9QAAAXT299.png',
		
		showToast:false,  //吐司提示框的展示与否  false-不展示，true-展示
	  	toastMsg:'' //吐司提示信息
	},
	computed:{
		tag_style:function(){
			var obj = {
				color: this.color,
    				border: '2px solid '+this.color,
    				background:'url('+ this.tagbg +') 101% 103% /18px 20px no-repeat'
			}
			return obj;
		}
		
	},
	mounted: function(){
		this.init();
	},
	methods:{
		init:function (){
			this.checkLogin();
        },
        checkLogin:function(){ //检测登录状态
        		var vm = this;
        		$.ajax({
		        method:'get',
		        url: '/ajax/Rechargerebate/getRebateIndex?time='+new Date().getTime(),
		        success:function(data){
			        if(data.code==200){  //登录，请求充返信息
		        			var result = data.result;
	                    	vm.version_show_subdesc = result.version_show_subdesc;  //当前版本是否支持设置 “需支付*元”
	                		vm.webHost = result.webHost;
	                		//vm.checkUserAgent(); //根据移动终端浏览器版本信息，检测是否支持apple pay---该功能已下线
						vm.getActiveInfo();  //获取充返活动信息
						vm.getUserAmout();   //获取账户余额
	              	}else{  //未登录，跳转登录页面
	                    window.location.href = 'yongche://login?done=' + encodeURIComponent(window.location.href);
	                }
			    },
			    error:function(e){
			        //alert('服务器异常，请稍后重试');   
			    }
		    });
        },
        
		showToastFn:function(msg,cb){  //toast提示
			var vm = this;
			vm.showToast = true;
     		vm.toastMsg = msg;
     		setTimeout(function(){
     			vm.showToast = false;
     			if(cb){ cb(); }
     		},2000)
		},
		getCookie:function (name){//读取cookie
			var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");
			if(arr=document.cookie.match(reg)){
				return unescape(arr[2]);
			}else{
				return null;
			}
		},
		getLocalStorage:function(params){     //获取本地存储，为结果页留存所需信息
			var storage = window.localStorage;
			var str = storage.getItem("params");
			var params = JSON.parse(str);
			
		}
  	}
})	
</script>

</body>
</html>
